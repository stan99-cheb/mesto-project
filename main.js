(()=>{"use strict";function e(e){"Escape"===e.key&&r(document.querySelector(".popup_active"))}function t(t){document.addEventListener("keydown",e),t.classList.add("popup_active")}function r(t){document.removeEventListener("keydown",e),t.classList.remove("popup_active")}document.querySelectorAll(".popup").forEach((function(e){e.addEventListener("mousedown",(function(t){t.target.classList.contains("popup_active")&&r(e),t.target.classList.contains("popup__close-button")&&r(e)}))}));var n,o,c,a,i,u,s,l,d,f,m,_,v,p,h,y,S,q,b,k,L,g,E,C,j={id:"",card:null},x={baseUrl:"https://nomoreparties.co/v1/plus-cohort-12",headers:{authorization:"5743d2b2-8d60-4e50-9a9c-7a3ab60b2c12","Content-Type":"application/json"}},A=function(){return fetch("".concat(x.baseUrl,"/users/me"),{headers:x.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log(e)}))},P=document.querySelector(".cards"),U=document.querySelector("#new-place").content,w=document.querySelector(".popup-image"),T=w.querySelector(".popup-image__name"),B=w.querySelector(".popup-image__link"),D="912df452cc2f9c1b7c925e7c",N=document.querySelector(".popup-delcard"),O=function(e){var t=U.cloneNode(!0);return t.querySelector(".card__name").textContent=e.name,t.querySelector(".card__link").src=e.link,t.querySelector(".card__link").alt="Изображение "+e.name,t.querySelector(".card__like").textContent=e.like.length,t.querySelector(".card__link").addEventListener("click",J),t.querySelector(".card__heart").addEventListener("click",(function(t){H(t,e.id)})),t.querySelector(".card__trash").addEventListener("click",(function(t){R(t,e.id)})),e.ownerId!==D&&t.querySelector(".card__trash").remove(),e.like.some((function(e){return e._id===D}))?t.querySelector(".card__heart").classList.add("card__heart_active"):t.querySelector(".card__heart").classList.remove("card__heart_active"),t},I=function(e){P.prepend(e)},J=function(e){T.textContent=e.target.alt,B.src=e.target.src,B.alt=e.target.alt,t(w)},H=function(e,t){var r;!function(e){return e.target.classList.contains("card__heart_active")}(e)?(e.target.classList.add("card__heart_active"),function(e){return fetch("".concat(x.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:x.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log(e)}))}(t).then((function(t){e.target.closest(".card").querySelector(".card__like").textContent=t.likes.length}))):(e.target.classList.remove("card__heart_active"),(r=t,fetch("".concat(x.baseUrl,"/cards/likes/").concat(r),{method:"DELETE",headers:x.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log(e)}))).then((function(t){e.target.closest(".card").querySelector(".card__like").textContent=t.likes.length})))},R=function(e,r){t(N),j.id=r,j.card=e.target},z="",M=function(e){var t=Array.from(e.querySelectorAll(".form__input")),r=e.querySelector(".form__submit-button");e.reset(),t.forEach((function(t){var r=e.querySelector(".".concat(t.id,"-error"));r.classList.contains("form__input-error_active")&&(t.classList.remove("form__input_type_error"),r.classList.remove("form__input-error_active"))})),r.classList.contains("form__submit-button_inactive")||(r.classList.add("form__submit-button_inactive"),r.setAttribute("disabled",""))},F=function(e,t){var r=e.querySelector(".form__submit-button");t?(z=r.textContent,r.textContent="Сохранение..."):r.textContent=z};n=document.querySelector(".profile__edit-button"),o=document.querySelector(".popup-profile"),c=o.querySelector(".form-profile"),a=c.querySelector(".form-profile__name"),i=c.querySelector(".form-profile__job"),u=document.querySelector(".profile__avatar"),s=document.querySelector(".profile__title"),l=document.querySelector(".profile__subtitle"),c.addEventListener("submit",(function(e){var t,n;e.preventDefault(),F(c,!0),s.textContent=a.value,l.textContent=i.value,(t=a.value,n=i.value,fetch("".concat(x.baseUrl,"/users/me"),{method:"PATCH",headers:x.headers,body:JSON.stringify({name:t,about:n})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log(e)}))).finally((function(){F(c,!1)})),r(o)})),A().then((function(e){s.textContent=e.name,l.textContent=e.about,u.src=e.avatar})),n.addEventListener("click",(function(){M(c),A().then((function(e){a.value=e.name,i.value=e.about})),t(o)})),d=document.querySelector(".profile__add-button"),f=document.querySelector(".popup-card"),m=f.querySelector(".form-card"),_=m.querySelector(".form-card__name"),v=m.querySelector(".form-card__link"),p={},m.addEventListener("submit",(function(e){var t,n;e.preventDefault(),F(m,!0),(t=_.value,n=v.value,fetch("".concat(x.baseUrl,"/cards"),{method:"POST",headers:x.headers,body:JSON.stringify({name:t,link:n})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log(e)}))).then((function(e){p.name=e.name,p.link=e.link,p.ownerId=e.owner._id,p.like=e.likes,p.id=e._id})).then((function(){return I(O(p))})).finally((function(){F(m,!1)})),r(f)})),d.addEventListener("click",(function(e){M(m),t(f)})),fetch("".concat(x.baseUrl,"/cards"),{headers:x.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log(e)})).then((function(e){e.map((function(e){return{name:e.name,link:e.link,like:e.likes,id:e._id,ownerId:e.owner._id}})).map((function(e){return O(e)})).reverse().forEach((function(e){I(e)}))})),function(){var e=document.querySelector(".profile__avatar"),n=document.querySelector(".popup-avatar"),o=document.querySelector(".form-avatar"),c=document.querySelector(".profile__avatar"),a=o.querySelector(".form-avatar__link");o.addEventListener("submit",(function(e){var t;e.preventDefault(),F(o,!0),(t=a.value,fetch("".concat(x.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:x.headers,body:JSON.stringify({avatar:t})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log(e)}))).then((function(e){c.src=e.avatar})).finally((function(){F(o,!1)})),r(n)})),e.addEventListener("click",(function(){M(o),t(n)}))}(),function(){var e=document.querySelector(".popup-delcard");document.querySelector(".form-delcard").addEventListener("submit",(function(t){var n;t.preventDefault(),(n=j.id,fetch("".concat(x.baseUrl,"/cards/").concat(n),{method:"DELETE",headers:x.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log(e)}))).then((function(){j.card.closest(".card").remove()})),r(e)}))}(),y=(h={formSelector:".form",inputSelector:".form__input",submitButtonSelector:".form__submit-button",inactiveButtonClass:"form__submit-button_inactive",inputErrorClass:"form__input_type_error",errorClass:"form__input-error_active"}).formSelector,S=h.inputSelector,q=h.submitButtonSelector,b=h.inactiveButtonClass,k=h.inputErrorClass,L=h.errorClass,g=Array.from(document.querySelectorAll(y)),E=function(e,t){t.validity.valid?function(e,t){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(k),r.textContent="",r.classList.remove(L)}(e,t):function(e,t,r){var n=e.querySelector(".".concat(t.id,"-error")),o=e.getBoundingClientRect(),c=t.getBoundingClientRect(),a=c.x-o.x,i=c.y-o.y+c.height;n.style.left=a+"px",n.style.top=i+"px",t.classList.add(k),n.textContent=r,n.classList.add(L)}(e,t,t.validationMessage)},C=function(e,t){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.removeAttribute("disabled"),t.classList.remove(b)):(t.setAttribute("disabled",""),t.classList.add(b))},g.forEach((function(e){!function(e){var t=Array.from(e.querySelectorAll(S)),r=e.querySelector(q);C(t,r),t.forEach((function(n){n.addEventListener("input",(function(){E(e,n),C(t,r)}))}))}(e)}))})();